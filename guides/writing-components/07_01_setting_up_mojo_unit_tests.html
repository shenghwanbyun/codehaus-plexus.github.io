<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-09-13 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Rahul Thakur" />
    <meta name="Date-Revision-yyyymmdd" content="20150913" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Plexus &#x2013; Using a Plexus Component from a Maven Mojo.</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.4.min.js"></script>

                          
        
<link rel="icon" type="image/x-icon" href="/favicon.ico"/>
                      
        
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../.././" id="bannerLeft">
                                                                                                <img src="../../images/plexus-logo-trans.png"  alt="Plexus"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../../" title="Plexus">
        Plexus</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Using a Plexus Component from a Maven Mojo.</li>
        
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2015-09-13</li>
            
                                    
    <li class="pull-right">
                      <a href="../.././" title="Plexus">
        Plexus</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../../dav:https:/dav.codehaus.org/plexus/index.html" title="Plexus">
          <span class="none"></span>
        Plexus</a>
            </li>
                                        <li class="nav-header">Plexus</li>
                              
      <li>
  
                          <a href="../../index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                              <li class="nav-header">Plexus Projects</li>
                              
      <li>
  
                          <a href="../../modello/" title="Modello">
          <span class="none"></span>
        Modello</a>
            </li>
                
      <li>
  
                          <a href="../../plexus-classworlds/" title="Plexus Classworlds">
          <span class="none"></span>
        Plexus Classworlds</a>
            </li>
                
      <li>
  
                          <a href="../../plexus-containers/" title="Plexus Container">
          <span class="none"></span>
        Plexus Container</a>
            </li>
                
      <li>
  
                          <a href="../../plexus-components/" title="Plexus Components">
          <span class="none"></span>
        Plexus Components</a>
            </li>
                
      <li>
  
                          <a href="../../plexus-utils/" title="Plexus Utils">
          <span class="none"></span>
        Plexus Utils</a>
            </li>
                              <li class="nav-header">Downloads</li>
                              
      <li>
  
                          <a href="../../source-repository.html" title="Sources">
          <span class="none"></span>
        Sources</a>
            </li>
                
      <li>
  
                          <a href="../../download-binaries.html" title="Binaries">
          <span class="none"></span>
        Binaries</a>
            </li>
                              <li class="nav-header">Books</li>
                              
      <li>
  
                          <a href="../../writing-components-trail/index.html" title="Writing Components">
          <span class="none"></span>
        Writing Components</a>
            </li>
                              <li class="nav-header">Guides</li>
                              
      <li>
  
                          <a href="../../guides/quick-start/getting-started.html" title="Quick Start">
          <span class="none"></span>
        Quick Start</a>
            </li>
                
      <li>
  
                          <a href="../../guides/writing-components/00_index.html" title="Writing Plexus Components">
          <span class="none"></span>
        Writing Plexus Components</a>
            </li>
                
      <li>
  
                          <a href="../../guides/developer-guide/index.html" title="Developer Guide">
          <span class="none"></span>
        Developer Guide</a>
            </li>
                              <li class="nav-header">Reference</li>
                              
      <li>
  
                          <a href="../../ref/why-use-components.html" title="Why Use Components?">
          <span class="none"></span>
        Why Use Components?</a>
            </li>
                
      <li>
  
                          <a href="../../ref/plexus-descriptor.html" title="Plexus Descriptor">
          <span class="none"></span>
        Plexus Descriptor</a>
            </li>
                
      <li>
  
                          <a href="../../guides/developer-guide/configuration/component-descriptor.html" title="Component Descriptor">
          <span class="none"></span>
        Component Descriptor</a>
            </li>
                
      <li>
  
                          <a href="../../ref/component-configuration.html" title="Component Configuration">
          <span class="none"></span>
        Component Configuration</a>
            </li>
                
      <li>
  
                          <a href="../../ref/technical-articles.html" title="Technical Articles">
          <span class="none"></span>
        Technical Articles</a>
            </li>
                
      <li>
  
                          <a href="../../ref/available-components.html" title="Available Components">
          <span class="none"></span>
        Available Components</a>
            </li>
                
      <li>
  
                          <a href="../../faq.html" title="FAQs">
          <span class="none"></span>
        FAQs</a>
            </li>
                              <li class="nav-header">Community</li>
                              
      <li>
  
                          <a href="../../mail-lists.html" title="Mailing Lists">
          <span class="none"></span>
        Mailing Lists</a>
            </li>
                
      <li>
  
                          <a href="../../irc.html" title="IRC">
          <span class="none"></span>
        IRC</a>
            </li>
                
      <li>
  
                          <a href="../../get-involved.html" title="Get Involved">
          <span class="none"></span>
        Get Involved</a>
            </li>
                                        <li class="nav-header">Project Documentation</li>
                                                                                                                                      
      <li>
  
                          <a href="../../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                              <li class="nav-header">Plexus Projects</li>
                              
      <li>
  
                          <a href="../../dav:https:/dav.codehaus.org/plexus/plexus-classworlds/" title="Plexus Classworlds">
          <span class="none"></span>
        Plexus Classworlds</a>
            </li>
                
      <li>
  
                          <a href="../../dav:https:/dav.codehaus.org/plexus/plexus-containers/" title="Plexus Container">
          <span class="none"></span>
        Plexus Container</a>
            </li>
                
      <li>
  
                          <a href="../../dav:https:/dav.codehaus.org/plexus/plexus-components/" title="Plexus Components">
          <span class="none"></span>
        Plexus Components</a>
            </li>
                
      <li>
  
                          <a href="../../dav:https:/dav.codehaus.org/plexus/plexus-utils/" title="Plexus Utils">
          <span class="none"></span>
        Plexus Utils</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="http://codehaus-plexus.github.io/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://codehaus-plexus.github.io/" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <p><tt>The contents of this document are a work in progress</tt></p>
<div class="section">
<h2><a name="Setting_up_unit_tests_for_Monitor_Mojo"></a>Setting up unit tests for Monitor Mojo </h2>
<p>Unit testing allows us to test out our Mojo implmentation without requiring a project to be set up. </p>
<p>Maven provides a <b>Plugin Test Harness</b> to enable testing of Mojos. </p>
<p>Some relatively comprehensive notes on the Maven Plugin Harness are available <a class="externalLink" href="http://docs.codehaus.org/display/MAVEN/Maven+Plugin+Harness">here</a>.</p>
<div class="section">
<h3><a name="Adding_test_sources_directory_to_the_project"></a>Adding test sources directory to the project </h3>
<p>This step is needed as the Mojo Archetype (as of this writing) does not sets up test folder when we created our Maven plugin project.</p>
<ol style="list-style-type: decimal">
<li>To the project root add a directory <tt>src/test/java</tt>. We will create our unit tests under this location. </li>
<li>To the project root add a director <tt>src/test/resources</tt>. This directory will hold resources that we use for Mojo testing. </li></ol></div>
<div class="section">
<h3><a name="Adding_plugin_test_harness_dependency"></a>Adding plugin test harness dependency</h3>
<ol style="list-style-type: decimal">
<li>First thing we need to do is to add the Maven plugin test harness dependency to our Plugin's <tt>pom.xml</tt>. Locate the <tt>pom.xml</tt> and add the harness dependency as follows.
<div class="source"><pre class="prettyprint linenums">  &lt;dependencies&gt;
    .
    .
    .
   &lt;dependency&gt;
      &lt;groupId&gt;org.apache.maven.shared&lt;/groupId&gt;
      &lt;artifactId&gt;maven-plugin-testing-harness&lt;/artifactId&gt;
      &lt;version&gt;1.0-beta-1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;</pre></div></li>
<li>Next we need to update depdendency references in our Eclipse project settings to make the plugin testing harness available. To do this run the following from the command prompt from the plugin project's directory.
<div class="source"><pre class="prettyprint linenums"> mvn eclipse:clean eclipse:eclipse</pre></div></li>
<li>Refresh the Eclipse project by selecting the project root folder and pressing 'F5' key. 
<p>You will see that the plugin testing harness dependency and the test directory that we added in the previous step are now updated. </p></li></ol></div>
<div class="section">
<h3><a name="Writing_our_Mojo_unit_tests"></a>Writing our Mojo unit tests</h3>
<ol style="list-style-type: decimal">
<li>Create a new package <tt>org.codehaus.plexus</tt> to create our test in. Note that we create the package with the same name that our Mojo implementation resides in. This is a convenience to test out methods on Mojo which may have access specifiers that allow access only from within same package.</li>
<li>We write a couple of tests to ensure that our Mojo instance is being retrieved as expected, and to test that it executes without errors for a valid list of websites.
<p>Our test source looks as follows: </p>
<div class="source"><pre class="prettyprint linenums">public class MonitorMojoTest
    extends AbstractMojoTestCase
{

    public void testMojoLookup()
        throws Exception
    {
        File pluginXml = new File( getBasedir(), &quot;src/test/resources/unit/plugin-config.xml&quot; );
        MonitorMojo mojo = (MonitorMojo) lookupMojo( &quot;monitor&quot;, pluginXml );
        assertNotNull( mojo );
    }

    public void testMojoExecution()
        throws Exception
    {
        File pluginXml = new File( getBasedir(), &quot;src/test/resources/unit/plugin-config.xml&quot; );
        MonitorMojo mojo = (MonitorMojo) lookupMojo( &quot;monitor&quot;, pluginXml );
        assertNotNull( mojo.getWebsites() );
        assertEquals( 1, mojo.getWebsites().size() );
        assertNotNull( mojo.getMonitor() );
        try
        {
            mojo.execute();
        }
        catch ( Exception e )
        {
            fail( &quot;Unexpected exception with test data.&quot; );
        }
    }
}</pre></div></li>
<li>We set up a test configuration for the Mojo under <tt>src/test/resources/unit/plugin-config.xml</tt> (yes, that's the file that we refer to in the test above!).
<div class="source"><pre class="prettyprint linenums">&lt;project&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.plexus&lt;/groupId&gt;
        &lt;artifactId&gt;plexus-website-monitor-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;websites&gt;
            &lt;website&gt;http://plexus.codehaus.org/&lt;/website&gt;
          &lt;/websites&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div></li>
<li>Also our Mojo implementation is now updated to be as below:
<div class="source"><pre class="prettyprint linenums">public class MonitorMojo
    extends AbstractMojo
{

    /**
     * List of websites to monitor.
     * @parameter 
     */
    private List websites;

    /**
     * The website monitor component instance that will be injected 
     * by the Plexus runtime.
     * @component 
     */
    private WebsiteMonitor monitor;

    public void execute()
        throws MojoExecutionException, MojoFailureException
    {
        if ( !hasWebsites() )
        {
            if ( getLog().isWarnEnabled() )
                getLog().warn( &quot;No websites specified to be monitored.&quot; );
            return;
        }

        if ( getLog().isDebugEnabled() )
            showMonitoredWebsites();

        monitor.addWebsites( websites );
        try
        {
            monitor.monitor();
        }
        catch ( Exception e )
        {
            if ( getLog().isErrorEnabled() )
                getLog().error( &quot;Error monitoring websites.&quot;, e );
        }
    }

    private void showMonitoredWebsites()
    {
        getLog().debug( &quot;Monitoring following websites:&quot; );
        for ( Iterator it = websites.iterator(); it.hasNext(); )
        {
            String website = (String) it.next();
            getLog().debug( &quot;\t&quot; + website );
        }
    }

    /**
     * Determines if websites were specified to the Mojo.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if there were websites specified.
     */
    private boolean hasWebsites()
    {
        return ( null != websites &amp;&amp; websites.size() &gt; 0 );
    }

    /**
     * Returns the list of websites.&lt;p&gt;
     * &lt;em&gt;Not public API. For unit tests only.&lt;/em&gt;
     * 
     * @return List of websites specified via Mojo configuration.
     */
    protected List getWebsites()
    {
        return this.websites;
    }

    /**
     * Returns the {@link WebsiteMonitor} component instance.&lt;p&gt;
     * &lt;em&gt;Not public API. For unit tests only.&lt;/em&gt;
     * 
     * @return the {@link WebsiteMonitor} instance.
     */
    protected WebsiteMonitor getMonitor()
    {
        return monitor;
    }

}</pre></div></li>
<li>Let's run the test and see what happens. You can run the test from within your favourite IDE, or from command prompt by typing
<div class="source"><pre class="prettyprint linenums"> mvn clean test </pre></div>
<p>At this point, the Mojo test should run without any failures. </p>
<p>Great! You have just hooked your Plexus component successfully to a Maven plugin.</p>
<p>For more information on developing and using Maven plugins, please refer to <a class="externalLink" href="http://maven.apache.org/guides/plugin/guide-java-plugin-development.html">Guide to Developing Java Plugins</a></p></li></ol></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2001&#x2013;2015
                        <a href="http://codehaus-plexus.github.io/">Codehaus Plexus</a>.
            All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>